<style>
  .swiper-button-next:after,
  .swiper-button-prev:after {
    font-size: 1rem;
  }

  .section-{{ section.id }}
  -props {
    --padding-top: {{ section.settings.mobile_padding_top }}rem;
    --padding-bottom: {{ section.settings.mobile_padding_bottom }}rem;
  }

  @media screen and (min-width: 1024px) {
    .section-{{ section.id }}-props {
      --padding-top: {{ section.settings.padding_top }}rem;
      --padding-bottom: {{ section.settings.padding_bottom }}rem;
    }
  }

  .section-{{ section.id }}
  -props {
    margin-top: var(--padding-top);
    margin-bottom: var(--padding-bottom);
  }

  .variant-radio {
    display: none !important;
  }

  .variant-radio:checked + .variant-label {
    background-color: white;
    color: #322F30;
  }
</style>

<product-info id="MainProduct-{{ section.id }}" class="tw-w-full tw-flex tw-justify-center tw-items-center tw-relative section-{{ section.id }}-props">
  <div class="tw-absolute tw-top-full tw-w-full tw-border-b tw-z-10"></div>
  <div class="tw-flex md:tw-flex-row tw-flex-col  tw-w-full tw-max-w-screen-2xl">
    <!-- -------------------------- -->
    <!-- Mobile Brand Name -->
    <!-- -------------------------- -->
    {% comment %} <div class="tw-flex tw-flex-col tw-justify-center tw-gap-4 md:tw-hidden">
                  <!-- Mobile Brand Name -->
                  {% render 'ud-text'
                    , text: product.title
                    , type: 'header'
                    , align: 'start'
                    , size: 'small'
                    , color: 'black' %}
            </div> {% endcomment %}

    <!-- -------------------------------- -->
    <!-- Column 1 (Image Gallery) -->
    <!-- -------------------------------- -->
    <div class="tw-h-full tw-w-full md:tw-w-1/2 tw-bg-brand-navy">

      {{ product.featured_image | image_url: width: 2000 | image_tag: class: 'tw-w-full tw-h-full tw-object-cover' }}

    {% comment %} <div class=" swiper swiper-container tw-h-full lg:tw-h-auto  tw-w-full">
                    <div class="swiper-wrapper tw-h-full ">
                      <!-- Image Classes -->
                      {%- liquid
                        if section.settings.image_aspect == '4x3'
                          assign size_classes = 'tw-w-full tw-aspect-4/3 tw-h-fit '
                        elsif section.settings.image_aspect == '3x8'
                          assign size_classes = 'tw-aspect-8x3 md:tw-h-[45rem] tw-h-fit tw-w-fit '
                        elsif section.settings.image_aspect == 'square'
                          assign size_classes = 'tw-aspect-square md:tw-max-h-[30rem] tw-max-h-[20rem] tw-h-fit tw-w-fit '
                        else
                          assign size_classes = 'tw-w-full'
                        endif
                        if section.settings.contain
                          assign contain_classes = 'tw-object-contain tw-p-2 tw-border'
                        else
                          assign contain_classes = 'tw-border tw-object-cover tw-border'
                        endif
                        assign image_classes = size_classes | append: contain_classes
                      -%}
                      {% if product.has_only_default_variant == false %}
                        <!-- Variant Image -->
                        <div class="swiper-slide tw-rounded-lg tw-h-full tw-flex tw-items-center tw-justify-center">
                          {{ product.selected_or_first_available_variant.featured_image | image_url: width: 800 | image_tag: class: image_classes }}
                        </div>
                      {% endif %}
                      <!-- All Normal Images -->
                      {% for image in product.images %}
                         {% if image.attached_to_variant? != true  %} 
                         {% if forloop.first %}
                          <div class="swiper-slide tw-rounded-lg tw-h-full tw-flex tw-items-center tw-justify-center">
                            {{ image | image_url: width: 1200 | image_tag: class: image_classes }}
                          </div>
                          {% endif %}
                         {% endif %}
                      {% endfor %}
                    </div>
              </div> {% endcomment %}

    </div>

    <!-- Second column -->
    <div class="md:tw-w-1/2 tw-flex tw-border-l tw-relative tw-flex-col tw-justify-center">
    <div class="tw-relative tw-overflow-hidden">
      <div class="tw-absolute tw-top-full tw-w-screen tw-border-b tw-z-10"></div>
      <div class="tw-p-8">

        <div class="tw-flex tw-py-12 tw-flex-col tw-justify-center tw-gap-4 max-md:tw-hidden">
          {% if product.metafields.custom.product_brand != blank %}
            <!-- Desktop Brand Name -->
            <span class="tw-text-16">
              {{ product.metafields.custom.product_brand.value.location.value.city }}, {{ product.metafields.custom.product_brand.value.location.value.state }} / {{ product.metafields.custom.product_brand.value.name }}
            </span>
          {% endif %}
          <!-- Desktop Title -->
          {% render 'ud-text'
          , text: product.title
          , type: 'mainheader'
          , align: 'start'
          , size: 'medium'
          , color: 'black' %}
          <!-- Product Price -->
          {% assign product_price = product.selected_or_first_available_variant.price | money %}
          {% render 'ud-text'
          , text: product_price
          , type: 'subheader'
          , align: 'start'
          , size: 'large'
          , color: 'black' %}
          <!-- Desktop Description -->
          {% assign product_description = product.description | default: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.' %}
          {% render 'ud-text'
            , text: product_description
            , type: 'body'
            , align: 'start'
            , size: 'medium'
            , color: 'black' %}

          <!-- Variant Selector -->
           {%- unless product.has_only_default_variant -%}
            {% for option in product.options_with_values %}
          <div class="tw-flex tw-flex-col tw-gap-4 tw-w-full">
            {%  assign opt_name = option.name |  upcase %}
            {% render 'ud-text'
              , text: opt_name
              , type: 'subheader'
              , align: 'start'
              , size: 'medium'
              , color: 'black' %}
            <select class="tw-w-2/3 tw-border tw-p-4">
            {% for value in option.values %}
              <option>{{value}}</option>
            {% endfor %}
            </select>
          </div>
            {% endfor %}
          {% endunless %}
        </div>
        <!-- ------------------------------ -->
        <!-- Product Variant Selector -->
        <!-- ------------------------------ -->
        {% comment %} <div class="tw-flex tw-flex-col tw-gap-2">
                              {% content_for 'blocks' %}
                            </div>
        
                            <div class="tw-flex-wrap tw-flex tw-gap-4">
                              {%- assign product_form_id = 'product-form-' | append: section.id -%}
        
                              {%- unless product.has_only_default_variant -%}
                                {% for option in product.options_with_values %}
                                  <div
                                    id="variant-selects-{{ section.id }}"
                                    data-section="{{ section.id }}"
                                    class="tw-flex tw-flex-col tw-gap-4">
                                    <legend>
                                      <span class="tw-font-bold tw-text-black tw-text-16">{{ option.name }}:</span>
                                      <span data-selected-value>
                                        {{- option.selected_value -}}
                                      </span>
                                    </legend>
                                    <div
                                      id="variant-selects-{{ section.id }}"
                                      data-section="{{ section.id }}"
                                      class="tw-flex tw-flex-wrap tw-gap-4">
                                      <!-- ------------------------------ -->
                                      <!-- Variant Options -->
                                      <!-- ------------------------------ -->
                                      {% for value in option.values %}
                                        {%- capture input_id -%}
                                        {{ section.id }}-{{ option.position }}-{{ forloop.index0 -}}
                                        {%- endcapture -%}
                                        {%- capture input_name -%}
                                          {{ option.name }}-{{ option.position }}
                                        {%- endcapture -%}
                                        {% if value.variant != blank %}
                                          <input
                                            type="radio"
                                            id="{{ input_id }}"
                                            name="{{ input_name | escape }}"
                                            value="{{ value | escape }}"
                                            form="{{ product_form_id }}"
                                            class="variant-radio"
                                            {% if value.selected %}
                                            checked
                                            {% endif %}>
                                          <label class="tw-flex tw-justify-center tw-items-center tw-flex-col tw-text-14 tw-relative tw-group tw-pointer" for="{{ input_id }}">
                                            <a
                                              id="{{ id }}"
                                              href="{{product.url}}?variant={{ value.variant.id }}"
                                              class=" !tw-text-black tw-rounded-md tw-p-2 tw-text-center tw-border {% if value.variant.id == product.selected_or_first_available_variant.id %} tw-pointer-events-none tw-cursor-not-allowed tw-border-blue-light tw-border {% endif %}"
                                              aria-label="{{ value | escape }}">{{ value }}</a>
        
                                          </label>
                                        {% else %}
                                          {% for variant in product.variants %}
                                            {% if variant.option1 == value %}
                                              <a
                                                id="{{ variant.id }}"
                                                href="{{product.url}}?variant={{ variant.id }}"
                                                class=" !tw-text-black tw-rounded-md tw-p-2 tw-text-center tw-border"
                                                aria-label="{{ value | escape }}">
                                                {{ value }}
                                              </a>
                                              {% break %}
                                            {% endif %}
                                            {% assign firstVar = '' %}
                                          {% endfor %}
                                        {% endif %}
                                      {% endfor %}
                                    </div>
                                  </div>
                                {% endfor %}
                              {%- endunless -%}
                        </div> {% endcomment %}
  
        <!-- Add to cart button (Black Full Width) -->
        <div class="tw-flex tw-gap-8">
          <div class="tw-flex tw-gap-4">
            <div class="tw-flex tw-w-full tw-gap-2 tw-flex-row tw-items-center">
              <div class="tw-relative tw-flex tw-items-center tw-border  tw-h-full tw-w-[4.5rem] tw-max-w-28 ">
                  {% comment %} <button
                                                          type="button"
                                                          id="decrement-button"
                                                          aria-label="remove"
                                                          @click="quantity--"
                                                          :disabled="quantity <= 1"
                                                          class="tw-bg-brand-bg-dark tw-rounded-lg tw-pl-2 tw-pr-2"
                                                          :class="quantity <= 1 ? 'tw-cursor-not-allowed' : ''">
                                                          <svg
                                                            class="tw-w-3 tw-h-3 tw-text-gray-900 tw-dark:tw-text-white"
                                                            aria-hidden="true"
                                                            xmlns="http://www.w3.org/2000/svg"
                                                            fill="none"
                                                            viewBox="0 0 18 2">
                                                            <path
                                                              stroke="currentColor"
                                                              stroke-linecap="round"
                                                              stroke-linejoin="round"
                                                              stroke-width="2"
                                                              d="M1 1h16" />
                                                          </svg>
                                                    </button> {% endcomment %}
                <input
                  type="integer"
                  id="quantity-input"
                  name="quantity"
                  value="1"
                  min="1"
                  max="100"
                  class="tw-h-full tw-w-full tw-text-center tw-text-sm tw-block tw-py-1 tw-bg-brand-bg-light">
                {% comment %} <button
                                                      required
                                                      v-model="quantity"
                                                      max="{{ product.selected_or_first_available_variant.inventory_quantity }}"
                                                      @input="quantity < 1 ? quantity = 1 : quantity = quantity"
                                                      type="button"
                                                      id="increment-button"
                                                      aria-label="add"
                                                      @click="quantity++"
                                                      class="tw-bg-brand-bg-dark tw-rounded-lg tw-pr-4 tw-pl-2">
                                                      <svg
                                                        class="tw-w-3 tw-h-3 tw-text-gray-900 tw-dark:text-white"
                                                        aria-hidden="true"
                                                        xmlns="http://www.w3.org/2000/svg"
                                                        fill="none"
                                                        viewBox="0 0 18 18">
                                                        <path
                                                          stroke="currentColor"
                                                          stroke-linecap="round"
                                                          stroke-linejoin="round"
                                                          stroke-width="2"
                                                          d="M9 1v16M1 9h16" />
                                                      </svg>
                                                </button> {% endcomment %}
              </div>
            </div>
          </div>
  
          <button
            type="submit"
            v-if="!addingToCart"
            @click="addToCart"
            class="tw-bg-brand-navy/100 hover:tw-bg-brand-navy/95 focus:tw-bg-brand-navy/95 tw-border-brand-navy/100 tw-text-white tw-w-full tw-flex tw-justify-center tw-border tw-py-2 tw-px-10 tw-transition-button duration-200 ease-in-out tw-font-semibold tw-font-montserrat hover:tw-scale-[102%]">
            Add to Cart
          </button>
        </div>

      </div>
      </div>
      <div>
        <!-- Related Products -->
        <div class="tw-overflow-hidden tw-py-12 tw-p-8">
          <div class="tw-flex tw-flex-col tw-gap-4">
            {%  assign featured_collection = product.metafields.custom.product_brand.value.collection.value %}
            <h3 class="tw-text-24 tw-font-bold">More from: {{ product.metafields.custom.product_brand.value.name }}</h3>
            <div class="tw-flex tw-gap-8">
              {%  assign p_index = 1 %}
              {% for c_product in featured_collection.products %}
                {% if c_product == product %}
                  {%  continue %}
                {% endif %}
                {% if p_index < 4 %}
                  <a href="{{ c_product.url }}" class="tw-w-1/3">
                  <div class="tw-flex tw-flex-col tw-gap-2">
                    {{ c_product.featured_image | image_url: width: 800 | image_tag: class: 'tw-w-full tw-h-full tw-object-cover' }}
                    {% render 'ud-text'
                    , text: c_product.title
                    , type: 'body'
                    , align: 'start'
                    , size: 'small'
                    , color: 'black' %}
                    </div>
                    </a>
                {%  assign p_index = p_index |  plus: 1 %}
                {%  else %}
                  {%  break  %}
                {% endif %}
              {% endfor %}
            </div>
            <a class="tw-pt-2 tw-underline" href="{{ featured_collection.url }}">
              {% render 'ud-text'
                , text: 'SHOP ALL'
                , type: 'subheader'
                , align: 'start'
                , size: 'medium'
                , color: 'black' %}
            </a>

          {% comment %} <div class="swiper-wrapper">
                                        {% for product in section.settings.related_product_list %}
                                          <div class="swiper-slide">
                                            <a href="{{ product.url }}" class="tw-justify-center tw-flex tw-flex-col tw-gap-2 tw-p-2 tw-h-full hover:tw-scale-105 tw-transition-transform tw-duration-150">
                                                <!-- Product Image -->
                                              <img
                                                class="tw-w-full tw-h-24 tw-aspect-3/4 tw-aspect-video tw-object-cover tw-object-center tw-rounded-md"
                                                src="{{ product.featured_image | img_url: '768x768' }}"
                                                alt="{{ product.title | escape }}"
                                                height="100%"
                                                width="100%">
                                              <!-- Product Title -->
                                              <div class="tw-truncate tw-underline tw-text-14  tw-underline-offset-4">{{ product.title }}</div>
                                            </a>
                                          </div>
                                        {% endfor %}
                                  </div> {% endcomment %}
          </div>
        </div>
      </div>


    </div>
  </div>
</product-info>

{% if product.selected_or_first_available_variant.metafields.custom.bundled_variant.value.id != blank %}
  {% assign product_price = product.selected_or_first_available_variant.price
 | plus: product.selected_or_first_available_variant.metafields.custom.bundled_variant.value.price
  %}
{% else %}
  {% assign product_price = product.selected_or_first_available_variant.price %}
{% endif %}
{% comment %} 
      <script>
        new Vue({
          el: '.section-{{ section.id }}-props',
          delimiters: ['[[', ']]'],
          mixins: [global],
          data() {
            return {
              quantity: 1,
              addingToCart: false,
              shippingMethod: 'Standard',
              productPrice: '{{ product_price }}',
              openedBlocks: [String('block-{{ section.blocks[0].id }}').slice(0, -2)],
              productBlock: 'test',
            };
          },
          computed: {
            totalPrice() {
              let dividedProductPrice = this.productPrice / 100;
              let basePrice = dividedProductPrice * this.quantity;
              return basePrice;
            },
          },
          methods: {
            toggleBlock(block) {
              console.log(this.openedBlocks);
              if (this.openedBlocks.includes(block)) {
                const index = this.openedBlocks.indexOf(block);
                this.openedBlocks.splice(index, 1);
              } else {
                this.openedBlocks.push(block);
              }
            },
            async addToCart() {
              this.addingToCart = true;
              let items = [
                {
                  quantity: this.quantity || 1,
                  {% if product.metafields.custom.adhesive_tab_count > 0 %}
                    'properties': {
                      'adhesive-tabs': Math.round(Number('{{ product.metafields.custom.adhesive_tab_count }}'))
                    },
                {% endif %}
                  {% if product.metafields.custom.mini_adhesive_tab_count > 0 %}
                    'properties': {
                      'mini-adhesive-tabs': Math.round(Number('{{ product.metafields.custom.mini_adhesive_tab_count }}'))
                    },
                {% endif %}
                  id: '{{ product.selected_or_first_available_variant.id }}',
                },
                {% if product.metafields.custom.adhesive_tab_count > 0 %}
                  {
                    quantity: Math.round(Number('{{ product.metafields.custom.adhesive_tab_count }}')),
                    id: '37500128919721',
                  },
                {% endif %}
                {% if product.metafields.custom.mini_adhesive_tab_count > 0 %}
                  {
                    quantity: Math.round(Number('{{ product.metafields.custom.adhesive_tab_count }}')),
                    id: '45111050698980',
                  },
                {% endif %}
              ];
      
              console.log(
                'test',
                '{{ product.selected_or_first_available_variant.metafields.custom.bundled_variant.value.id |  json }}'
              );
              if ('{{ product.selected_or_first_available_variant.metafields.custom.bundled_variant }}') {
                items.push({
                  quantity: this.quantity || 1,
                  id: '{{ product.selected_or_first_available_variant.metafields.custom.bundled_variant.value.id }}',
                });
              }
      
              items.reverse();
              axios
                .post('/cart/add.js', {
                  items: items,
                })
                .then((response) => {
                  this.showCart();
                  this.bus.$emit('refreshCart');
                  this.addingToCart = false;
                  this.$forceUpdate();
                })
                .catch((error) => {
                  console.log(error.response, 'caught error');
                  Swal.fire({
                    icon: 'error',
                    text: error.response.data.description,
                  });
                  this.addingToCart = false;
                })
                .finally(() => {
                  this.addingToCart = false;
                });
            },
          },
          mounted() {
            if ('{{ product.metafields.custom.special_shipping_options.value }}' == 'Freight Shipping Only') {
              this.shippingMethod = 'Freight';
            }
          },
        });
      
        var swiper2 = new Swiper('.swiper-container', {
          loop: true,
          spaceBetween: 10,
          slidesPerView: 1,
          thumbs: {
            swiper: swiper,
          },
        });
        var swiper = new Swiper('.swiper-thumbs', {
          loop: true,
          slidesPerView: 3.4,
          spaceBetween: 10,
          freeMode: true,
          watchSlidesProgress: true,
          breakpoints: {
            450: {
              slidesPerView: 2.4,
            },
            900: {
              slidesPerView: 3.4,
            },
            1440: {
              slidesPerView: 4.4,
            },
          },
        });
      
        var swiper3 = new Swiper('.related-swiper', {
          slidesPerView: 1.3,
          spaceBetween: 10,
          breakpoints: {
            900: {
              slidesPerView: 2.3,
            },
            1440: {
              slidesPerView: 3.3,
            },
          },
        });
      
        function goToSlide(index) {
          console.log(index);
          swiper2.slideTo(index);
        }
</script> {% endcomment %}

{% schema %}
  {
    "name": "Main Product",
    "enabled_on": {
      "templates": ["product"]
    },
    "settings": [
      {
        "type": "select",
        "id": "image_aspect",
        "label": "Image Aspect Ratio (Default 4x3)",
        "default": "4x3",
        "options": [
          {
            "label": "4x3",
            "value": "4x3"
          },
          {
            "label": "Square",
            "value": "square"
          },
          {
            "label": "Tall",
            "value": "3x8"
          }
        ]
      },
      {
        "type": "product_list",
        "id": "related_product_list",
        "label": "Suggested Related Products"
      },
      {
        "type": "range",
        "id": "padding_top",
        "label": "Padding Desktop",
        "min": 0,
        "max": 5,
        "default": 2,
        "unit": "rem"
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "label": "Padding Desktop",
        "min": 0,
        "max": 5,
        "default": 2,
        "unit": "rem"
      },
      {
        "type": "range",
        "id": "mobile_padding_top",
        "label": "Padding Mobile",
        "min": 0,
        "max": 5,
        "default": 2,
        "unit": "rem"
      },
      {
        "type": "range",
        "id": "mobile_padding_bottom",
        "label": "Padding Mobile",
        "min": 0,
        "max": 5,
        "default": 2,
        "unit": "rem"
      },
      {
        "type": "checkbox",
        "id": "contain",
        "label": "Contain Image?",
        "default": false
      },
      {
        "type": "checkbox",
        "id": "popular_item",
        "label": "Display Popular Item Text?",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "color_var_images",
        "label": "Show Color Variant Images?",
        "default": true
      }
    ],
    "blocks": [
      {
        "type": "_basic-variant-selector"
      }
    ],
    "presets": [
      {
        "name": "Main Product"
      }
    ]
  }
{% endschema %}