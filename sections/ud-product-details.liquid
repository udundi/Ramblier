<style>
  .swiper-button-next:after,
  .swiper-button-prev:after {
    font-size: 1rem;
  }

  .variant-radio {
    display: none !important;
  }

  .variant-radio:checked + .variant-label {
    background-color: white;
    color: #322f30;
  }

  .swiper-pagination-bullet {
    width: 11px;
    height: 11px;
    color: #000;
    opacity: 1;
    border: #000 solid 1px;
    background: transparent;
  }

  .swiper-pagination-bullet-active {
    color: #fff;
    background: #000;
  }

  .swiper-scrollbar-horizontal {
    --swiper-scrollbar-sides-offset: 0%;
    --swiper-scrollbar-bottom: 0%;
    --swiper-scrollbar-size: 6px;
  }

  .swiper-scrollbar-drag {
    --swiper-scrollbar-drag-bg-color: #000000;
    --swiper-scrollbar-border-radius: 0;
  }

  @media screen and (max-width: 768px) {
    .swiper-pagination {
      width: 100%;
      display: flex;
      bottom: 0 !important;
      position: absolute;
      gap: 0;
    }
    .swiper-pagination-bullet {
      width: 100%;
      height: 8px;
      color: #000;
      padding: 0;
      margin-left: 0 !important;
      margin-right: 0 !important;
      opacity: 1;
      border-radius: 0;
      border: 0 solid #000;
      background: #aaa;
    }

    .swiper-pagination-bullet-active {
      color: #fff;
      background: #000;
    }
  }
</style>

<product-info
  id="MainProduct-{{ section.id }}"
  class="tw-relative tw-flex tw-w-full tw-items-center tw-justify-center section-{{ section.id }}-props"
>
  <div class="tw-absolute tw-top-full tw-z-10 tw-w-full tw-border-b"></div>
  <div class="tw-flex tw-w-full tw-max-w-screen-3xl tw-flex-col md:tw-flex-row">
    <!-- -------------------------- -->
    <!-- Mobile Brand Name -->
    <!-- -------------------------- -->
    <div class="tw-flex tw-justify-center tw-gap-4 tw-py-4 tw-text-center tw-font-poppins md:tw-hidden">
      <!-- Mobile Brand Name -->
      <span class="tw-relative tw-w-fit tw-text-12">
        <span class="tw-absolute tw-right-[1em] tw-text-nowrap">
          {{- product.metafields.custom.product_brand.value.location.value.city }},
          {{ product.metafields.custom.product_brand.value.location.value.state -}}
        </span>
        <span>/</span>
        <span class="tw-absolute tw-left-[1em] tw-text-nowrap">
          {{- product.metafields.custom.product_brand.value.name -}}
        </span>
      </span>
    </div>

    <!-- -------------------------------- -->
    <!-- Column 1 (Image Gallery) -->
    <!-- -------------------------------- -->
    <div class="tw-relative tw-w-full tw-overflow-hidden max-md:tw-border-y md:tw-w-1/2">
      <button class="custom-button-prev tw-absolute tw-left-3 tw-top-1/2 tw-z-30 tw-size-9 tw-cursor-pointer tw-stroke-black md:tw-left-6 md:tw-size-11 lg:tw-left-12">
        {% render 'icon-arrow-left' %}
      </button>
      <button class="custom-button-next tw-absolute tw-right-3 tw-top-1/2 tw-z-30 tw-size-9 tw-cursor-pointer tw-stroke-black md:tw-right-6 md:tw-size-11 lg:tw-right-12">
        {% render 'icon-arrow-right' %}
      </button>
      <div class="swiper-container swiper tw-left-0 tw-top-0 tw-z-10 tw-h-full tw-w-full tw-cursor-grab max-md:tw-max-h-[80vh] md:tw-absolute">
        <div class="swiper-wrapper tw-h-full tw-w-full">
          {% if product.has_only_default_variant == false
            and product.selected_or_first_available_variant.featured_image != blank
          %}
            <!-- Variant Image -->
            <div class="swiper-slide tw-h-full tw-w-full">
              {{
                product.selected_or_first_available_variant.featured_image
                | image_url: width: 2000
                | image_tag: class: 'tw-w-full tw-h-full tw-object-cover tw-object-top'
              }}
            </div>
          {% endif %}
          {% for image in product.images %}
            {% if image.attached_to_variant? != true %}
              <div class="swiper-slide tw-h-full tw-w-full">
                {{
                  image
                  | image_url: width: 2000
                  | image_tag: class: 'tw-w-full tw-h-full tw-object-cover tw-object-top'
                }}
              </div>
            {% endif %}
          {% endfor %}
        </div>
        <div class="swiper-pagination max-md:!tw-hidden"></div>
        <div class="swiper-scrollbar md:!tw-hidden"></div>
      </div>
    </div>

    <!-- Second column -->
    <div class="tw-relative tw-flex tw-flex-col max-md:tw-justify-center md:tw-w-1/2 md:tw-border-l">
      <div class="tw-relative tw-overflow-hidden tw-border-b tw-border-black">
        <div class="tw-p-8 md:tw-py-16 xl:tw-px-24">
          <div class="tw-flex tw-flex-col tw-justify-center">
            {% if product.metafields.custom.product_brand != blank %}
              <!-- Desktop Brand Name -->
              <span class="tw-text-12 tw-text-black max-md:tw-hidden">
                {{ product.metafields.custom.product_brand.value.location.value.city }},
                {{ product.metafields.custom.product_brand.value.location.value.state }} /
                {{ product.metafields.custom.product_brand.value.name }}
              </span>
            {% endif %}

            <!-- Desktop Title -->
            <span class="tw-mt-3">
              {% render 'ud-text',
                text: product.title,
                type: 'mainheader',
                align: 'start',
                size: 'medium',
                color: 'black'
              %}
            </span>

            <!-- Product Price -->
            <span class="tw-mt-4 tw-tracking-wider">
              {% assign product_price = product.selected_or_first_available_variant.price | money %}
              {% render 'ud-text',
                text: product_price,
                type: 'subheader',
                align: 'start',
                size: 'small',
                color: 'black'
              %}
            </span>

            <!-- Desktop Description -->
            <span class="tw-mt-3">
              {% assign product_description = product.description
                | default: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.'
              %}
              {% render 'ud-text',
                text: product_description,
                type: 'body',
                align: 'start',
                size: 'small',
                color: 'black'
              %}
            </span>

            <!-- Variant Selector -->

            {%- unless product.has_only_default_variant -%}
              <span class="tw-mt-5">
                {% for option in product.options_with_values %}
                  <div class="tw-flex tw-w-full tw-flex-col tw-gap-4">
                    {% assign opt_name = option.name | upcase %}
                    {% render 'ud-text',
                      text: opt_name,
                      type: 'subheader',
                      align: 'start',
                      size: 'medium',
                      color: 'black'
                    %}
                    <div class="tw-w-fit tw-border tw-pr-2 focus-within:tw-border-black/0">
                      <select class="tw-w-fit tw-min-w-96 tw-p-4">
                        {% for value in option.values %}
                          <option>{{ value }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                {% endfor %}
              </span>
            {% endunless %}
          </div>
          <!-- ------------------------------ -->
          <!-- Product Variant Selector -->
          <!-- ------------------------------ -->

          <!-- Add to cart button (Black Full Width) -->
          <form action="/cart/add" method="post" class="tw-mt-8">
            <div class="tw-flex tw-gap-4">
              <div class="tw-flex tw-gap-4">
                <div class="tw-flex tw-w-full tw-flex-row tw-items-center tw-gap-2">
                  <div class="tw-relative tw-grid tw-h-full tw-w-fit tw-grid-cols-[2rem_2rem_2rem] tw-items-center tw-justify-center tw-border">
                    <button
                      id="quantity-subtract-{{ section.id }}"
                      class="tw-mx-auto tw-size-2.5 tw-text-black disabled:tw-cursor-not-allowed disabled:tw-text-opacity-50"
                      type="button"
                      disabled
                    >
                      {% render 'icon-minus' %}
                    </button>
                    <input
                      type="number"
                      id="quantity-input-{{ section.id }}"
                      name="quantity"
                      value="1"
                      min="1"
                      max="100"
                      step="1"
                      class="tw-text-sm tw-bg-brand-bg-light tw-block tw-h-full tw-w-full tw-py-1 tw-text-center"
                    >
                    <button
                      id="quantity-add-{{ section.id }}"
                      class="tw-mx-auto tw-size-2.5 tw-text-black"
                      type="button"
                    >
                      {% render 'icon-plus' %}
                    </button>
                  </div>
                </div>
              </div>
              <input
                type="hidden"
                name="id"
                value="{{ product.selected_or_first_available_variant.id }}"
              >
              <button
                type="submit"
                class="animated-button animated-button--hover-white tw-flex tw-w-full tw-justify-center tw-border tw-border-brand-navy/100 tw-bg-brand-navy/100 tw-px-10 tw-py-2 tw-font-montserrat tw-font-semibold tw-text-white tw-transition-button"
              >
                ADD TO CART
              </button>
            </div>
          </form>
        </div>
      </div>
      <div>
        <!-- Related Products -->
        <div class="tw-overflow-hidden tw-p-8 md:tw-py-16 xl:tw-px-24">
          <div class="tw-flex tw-flex-col tw-gap-4">
            {% assign featured_collection = product.metafields.custom.product_brand.value.collection.value %}
            <h3 class="tw-font-poppins tw-text-12 tw-font-semibold tw-tracking-wider tw-text-black md:tw-text-14">
              MORE FROM {{ product.metafields.custom.product_brand.value.name | upcase }}
            </h3>
            <div class="swiper-container-2 tw-flex tw-gap-8">
              {% assign p_index = 1 %}
              <div class="swiper-wrapper">
                {% for c_product in featured_collection.products %}
                  {% if c_product == product %}
                    {% continue %}
                  {% endif %}
                  {% if p_index < 11 %}
                    <div class="swiper-slide tw-w-1/3">
                      {% render 'ud-product-card', product: c_product %}
                    </div>
                    {% assign p_index = p_index | plus: 1 %}
                  {% else %}
                    {% break %}
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            <a class="tw-pt-2 tw-underline" href="{{ featured_collection.url }}">
              <span class="tw-relative tw-inline-flex tw-flex-col tw-overflow-hidden">
                <span class="tw-text-poppins tw-relative tw-text-12 tw-font-semibold tw-uppercase tw-tracking-wider md:tw-text-14">
                  Shop All
                </span>
                <span class="tw-self-stretch">{% render 'icon-drawn-underline' %}</span>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</product-info>

<script>
  var swiper = new Swiper('.swiper-container', {
    slidesPerView: 1,
    loop: true,
    navigation: {
      nextEl: '.custom-button-next',
      prevEl: '.custom-button-prev',
    },
    pagination: {
      el: '.swiper-pagination',
      clickable: true,
      renderBullet: function (index, className) {
        return '<span class="' + className + '"></span>';
      },
    },
    scrollbar: {
      el: '.swiper-scrollbar',
      draggable: true,
    },
  });

  var swiper2 = new Swiper('.swiper-container-2', {
    slidesPerView: 2.1,
    spaceBetween: 10,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev',
    },

    breakpoints: {
      1024: {
        slidesPerView: 3,
        spaceBetween: 8,
      },
    },
  });

  function goToSlide(index) {
    swiper.slideTo(index);
  }
</script>

<script type="module">
  const quantityInput = document.getElementById('quantity-input-{{ section.id }}');
  const addButton = document.getElementById('quantity-add-{{ section.id }}');
  const subtractButton = document.getElementById('quantity-subtract-{{ section.id }}');

  function onQuantityAdded(quantityInput) {
    quantityInput.value = Math.min(+quantityInput.max, +quantityInput.value + 1);
    addButton.disabled = +quantityInput.value >= +quantityInput.max;
    subtractButton.disabled = +quantityInput.value <= +quantityInput.min;
  }

  function onQuantitySubtracted(quantityInput) {
    quantityInput.value = Math.max(+quantityInput.min, +quantityInput.value - 1);
    addButton.disabled = +quantityInput.value >= +quantityInput.max;
    subtractButton.disabled = +quantityInput.value <= +quantityInput.min;
  }

  addButton.addEventListener('click', () => onQuantityAdded(quantityInput));
  subtractButton.addEventListener('click', () => onQuantitySubtracted(quantityInput));
</script>

{% schema %}
{
  "name": "Main Product",
  "enabled_on": {
    "templates": ["product"]
  },
  "settings": [
    {
      "type": "select",
      "id": "image_aspect",
      "label": "Image Aspect Ratio (Default 4x3)",
      "default": "4x3",
      "options": [
        {
          "label": "4x3",
          "value": "4x3"
        },
        {
          "label": "Square",
          "value": "square"
        },
        {
          "label": "Tall",
          "value": "3x8"
        }
      ]
    },
    {
      "type": "product_list",
      "id": "related_product_list",
      "label": "Suggested Related Products"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Desktop",
      "min": 0,
      "max": 5,
      "default": 2,
      "unit": "rem"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Desktop",
      "min": 0,
      "max": 5,
      "default": 2,
      "unit": "rem"
    },
    {
      "type": "range",
      "id": "mobile_padding_top",
      "label": "Padding Mobile",
      "min": 0,
      "max": 5,
      "default": 2,
      "unit": "rem"
    },
    {
      "type": "range",
      "id": "mobile_padding_bottom",
      "label": "Padding Mobile",
      "min": 0,
      "max": 5,
      "default": 2,
      "unit": "rem"
    },
    {
      "type": "checkbox",
      "id": "contain",
      "label": "Contain Image?",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "popular_item",
      "label": "Display Popular Item Text?",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "color_var_images",
      "label": "Show Color Variant Images?",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "_basic-variant-selector"
    }
  ],
  "presets": [
    {
      "name": "Main Product"
    }
  ]
}
{% endschema %}
